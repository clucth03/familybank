<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Family Bank</title>

<style>
:root{
  --bg:#f5f5f7;
  --card:#ffffff;
  --accent:#111827;
  --muted:#6b7280;
  --border:#e5e7eb;
}
*{box-sizing:border-box;}
body{
  margin:0;
  padding:12px;
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","YuGothic",sans-serif;
  background:var(--bg);
  color:#111827;
  font-size:16px;
}
h1{margin:0;font-size:22px;}
h2{margin:0 0 8px;font-size:18px;font-weight:600;}

.card{
  background:var(--card);
  border-radius:14px;
  padding:14px 16px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
}

/* sticky summary */
.sticky-summary{
  position:sticky;
  top:0;
  z-index:20;
}

.header-row{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:10px;
}
.subtext{
  font-size:13px;
  color:var(--muted);
}

select,button,input[type="number"]{
  font-size:15px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid #d1d5db;
  background:#fff;
}
button.primary{
  background:var(--accent);
  color:#fff;
  border:none;
}

.summary{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}
.summary-item{
  flex:1 1 140px;
  background:#f3f4f6;
  border-radius:12px;
  padding:10px 12px;
}
.summary-item .value{
  display:block;
  font-size:20px;
  font-weight:700;
  margin-top:4px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:15px;
}
th,td{
  padding:10px 6px;
  border-bottom:1px solid var(--border);
}
th{
  text-align:left;
  font-weight:600;
}
td.reward{
  text-align:right;
  font-size:18px;
  font-weight:600;
}
td.control{
  width:90px;
  text-align:center;
}

.task-name{
  font-size:16px;
  font-weight:600;
}
.desc{
  font-size:13px;
  color:var(--muted);
  margin-top:2px;
}

.counter-wrap{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}
.counter-wrap button{
  padding:4px 10px;
  border-radius:999px;
}

/* tabs */
.tabs{
  display:flex;
  gap:6px;
  margin-bottom:12px;
}
.tab-btn{
  flex:1 1 0;
  text-align:center;
  padding:8px 0;
  font-size:14px;
  border-radius:999px;
  border:1px solid #d1d5db;
  background:#fff;
}
.tab-btn.active{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
.tab-content{display:none;}
.tab-content.active{display:block;}

.history-group{
  margin-top:12px;
  padding-top:10px;
  border-top:1px dashed var(--border);
}
.history-title{
  font-size:16px;
  font-weight:700;
  margin-bottom:6px;
}
.history-row{
  font-size:15px;
  display:flex;
  justify-content:space-between;
  margin:4px 0;
}
.empty-text{
  font-size:14px;
  color:var(--muted);
  margin-top:8px;
}
</style>
</head>

<body>

<div class="card">
  <div class="tabs">
    <button class="tab-btn active" data-tab="main">今日のタスク</button>
    <button class="tab-btn" data-tab="month">月別のきろく</button>
    <button class="tab-btn" data-tab="week">週別のきろく</button>
  </div>
</div>

<div id="tab-main" class="tab-content active">
  <div class="card sticky-summary">
    <div class="header-row">
      <div>
        <h1>Family Bank</h1>
        <div class="subtext">
          タスクを入力すると、日・週・月の金額が自動集計されます。
        </div>
      </div>

      <div>
        <label for="childSelect" style="font-size:14px;">子ども：</label>
        <select id="childSelect">
          <option value="Cocoro">Cocoro</option>
          <option value="Sota">Sota</option>
          <option value="Eight">Eight</option>
        </select>
      </div>
    </div>

    <div class="summary">
      <div class="summary-item">
        今日の日付
        <span id="todayLabel" class="value"></span>
      </div>
      <div class="summary-item">
        今日の合計
        <span id="todayTotal" class="value">¥0</span>
      </div>
      <div class="summary-item">
        今週の合計
        <span id="weekTotal" class="value">¥0</span>
      </div>
      <div class="summary-item">
        今月の合計
        <span id="monthTotal" class="value">¥0</span>
      </div>
    </div>

    <div style="margin-top:12px;">
      <button id="resetTodayBtn">今日の入力をリセット</button>
      <button id="resetChildAllBtn">この子の全データを消去</button>
    </div>
  </div>

  <div class="card">
    <h2>タスク一覧</h2>
    <table>
      <thead>
        <tr>
          <th>タスク名</th>
          <th class="reward">報酬</th>
          <th class="control">入力</th>
        </tr>
      </thead>
      <tbody id="taskTableBody"></tbody>
    </table>
  </div>
</div>
<script>
// =============================
// タスク定義（最新版すべて反映済み）
// =============================
const TASKS = [
  // ------- 読書 -------
  {
    name: "読書・感想（Easy）",
    reward: 300,
    type: "check",
    desc: "1冊読んで、しっかりと感想を書く"
  },
  {
    name: "読書・感想（Normal）",
    reward: 1000,
    type: "check",
    desc: "1冊を丁寧に読み、内容を理解して自分の考えを書く"
  },
  {
    name: "読書・感想（Hard）",
    reward: 1500,
    type: "check",
    desc: "1冊を深く読み込み、気づきや分析を踏まえて感想を書く"
  },

  // ------- 学習系 -------
  {
    name: "調べ学習（1テーマ）",
    reward: 500,
    type: "check",
    desc: "調べたことをまとめる"
  },
  {
    name: "学習発表（図鑑学習→名称変更）",
    reward: 300,
    type: "check",
    desc: "なんでも良いので調べて家族の前で発表する"
  },

  // ------- 生活・家事 -------
  {
    name: "お風呂掃除（回数式）",
    reward: 50,
    type: "count",
    desc: "自分の担当範囲を全部掃除する"
  },
  {
    name: "朝起き（毎日連続チャレンジ）",
    reward: 300,
    type: "check",
    desc: "起こされずに自分で起きる"
  },
  {
    name: "部屋の片付け（週2回以上）",
    reward: 100,
    type: "check",
    desc: "週に2回達成"
  },
  {
    name: "玄関掃除（週2回以上）",
    reward: 200,
    type: "check",
    desc: "靴の整頓と掃き掃除"
  },
  {
    name: "皿拭き・片付け（回数式）",
    reward: 50,
    type: "count",
    desc: "道具の後片付け・拭き上げ・しまうまでを1セットとする"
  },
  {
    name: "上履き掃除",
    reward: 100,
    type: "check",
    desc: "上履きを洗って乾かす"
  },

  // ------- 創造 -------
  { name: "企画ポスター", reward: 300, type: "check" },
  { name: "手紙クリエイティブ", reward: 100, type: "check" },
  { name: "動画作成（インスタ用）", reward: 500, type: "check" },

  // ------- 社会性 -------
  {
    name: "新しいタスク案（2案なら1000円、1案なら500円）",
    reward: 1000,
    type: "check"
  },
  { name: "公共マナー実践", reward: 150, type: "check" },
  { name: "困っている人の手助け", reward: 150, type: "check" },

  // ------- 情緒・マインド -------
  {
    name: "感謝ノート（毎日）",
    reward: 100,
    type: "check",
    desc: "小さなことでも感謝を見つけて日付と一緒に書く"
  },
  {
    name: "自己肯定ワーク",
    reward: 100,
    type: "check",
    desc: "自分の良いところを書き出す（週3回以上）"
  },
  { name: "怒らないデー", reward: 200, type: "check" },
  {
    name: "サッカー・HC・バスケノート（1週達成）",
    reward: 100,
    type: "check"
  },

  // ------- 経営・数字 -------
  {
    name: "支出記録（月で）",
    reward: 100,
    type: "check"
  }
];

// =============================
// ローカルストレージ管理
// =============================
function loadData() {
  return JSON.parse(localStorage.getItem("familyBank") || "{}");
}
function saveData(data) {
  localStorage.setItem("familyBank", JSON.stringify(data));
}

// =============================
// 子ども選択
// =============================
const childSelect = document.getElementById("childSelect");

// =============================
// 日付 / 週 / 月 の計算
// =============================
function getTodayKey() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}
function getWeekKey() {
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth()+1;
  const w = Math.ceil(d.getDate()/7);
  return `${y}-${m}-week${w}`;
}
function getMonthKey() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}`;
}

// =============================
// UI構築
// =============================
function renderTasks() {
  const body = document.getElementById("taskTableBody");
  body.innerHTML = "";

  TASKS.forEach(task => {
    const tr = document.createElement("tr");

    // 名前
    const nameTd = document.createElement("td");
    nameTd.innerHTML = `<div class="task-name">${task.name}</div>
      ${task.desc ? `<div class="desc">${task.desc}</div>` : ""}`;
    tr.appendChild(nameTd);

    // 金額
    const rewardTd = document.createElement("td");
    rewardTd.className = "reward";
    rewardTd.textContent = `¥${task.reward}`;
    tr.appendChild(rewardTd);

    // 入力（チェック or 回数）
    const controlTd = document.createElement("td");
    controlTd.className = "control";

    if (task.type === "check") {
      const btn = document.createElement("button");
      btn.textContent = "✓";
      btn.onclick = () => addRecord(task, 1);
      controlTd.appendChild(btn);
    } else {
      const wrap = document.createElement("div");
      wrap.className = "counter-wrap";

      const minus = document.createElement("button");
      minus.textContent = "-";
      minus.onclick = () => addRecord(task, -1);

      const plus = document.createElement("button");
      plus.textContent = "+";
      plus.onclick = () => addRecord(task, 1);

      wrap.appendChild(minus);
      wrap.appendChild(plus);
      controlTd.appendChild(wrap);
    }

    tr.appendChild(controlTd);
    body.appendChild(tr);
  });
}

// =============================
// 記録追加
// =============================
function addRecord(task, count) {
  const child = childSelect.value;
  const data = loadData();

  if (!data[child]) data[child] = {};
  if (!data[child][getTodayKey()]) data[child][getTodayKey()] = [];

  if (count > 0) {
    for (let i = 0; i < count; i++) {
      data[child][getTodayKey()].push(task.reward);
    }
  } else {
    data[child][getTodayKey()].pop();
  }

  saveData(data);
  updateSummary();
}

// =============================
// サマリー更新
// =============================
function updateSummary() {
  const child = childSelect.value;
  const data = loadData();

  const todayKey = getTodayKey();
  const weekKey = getWeekKey();
  const monthKey = getMonthKey();

  let todayTotal = 0;
  let weekTotal = 0;
  let monthTotal = 0;

  if (data[child]) {
    Object.keys(data[child]).forEach(dateKey => {
      const sum = data[child][dateKey].reduce((a,b)=>a+b,0);

      if (dateKey === todayKey) todayTotal += sum;
      if (dateKey.startsWith(monthKey)) monthTotal += sum;
      if (dateKey.includes(weekKey.replace(/.*week/, "week"))) weekTotal += sum;
    });
  }

  document.getElementById("todayTotal").textContent = `¥${todayTotal}`;
  document.getElementById("weekTotal").textContent = `¥${weekTotal}`;
  document.getElementById("monthTotal").textContent = `¥${monthTotal}`;
  document.getElementById("todayLabel").textContent = todayKey;
}

// =============================
// リセット
// =============================
document.getElementById("resetTodayBtn").onclick = () => {
  const child = childSelect.value;
  const data = loadData();
  if (data[child]) {
    data[child][getTodayKey()] = [];
    saveData(data);
    updateSummary();
  }
};

document.getElementById("resetChildAllBtn").onclick = () => {
  const child = childSelect.value;
  const data = loadData();
  data[child] = {};
  saveData(data);
  updateSummary();
};

// =============================
// タブ切り替え（main / week / month）
// =============================
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById("tab-"+btn.dataset.tab).classList.add("active");
  };
});

// =============================
renderTasks();
updateSummary();
// =============================
</script>

</body>
</html>
